echo '~/kafka/bin/kafka-console-consumer.sh --zookeeper zookeeper-04.prod.visualdna.com $@' > ./kafka8 && chmod a+x ./kafka8

#test datasync 
cat src/test/resources/datasync.json \
| jq -r 'select(.partnerUserId!=null and .userUid!=null) | .userUid,.timestamp,.idSpace,.partnerUserId' \
| java -jar target/drift-loader.jar --keyspace vdna --table syncs

#stream of syncs
~/kafka8 --topic datasync \
| jq -r 'select(.partnerUserId!=null and .userUid!=null) | .userUid,.timestamp,.idSpace,.partnerUserId' \
| java -jar target/drift-loader.jar --keyspace vdna --table syncs

#test pageviews
cat src/test/resources/pageviews.json \
| jq -r 'select(.userUid!=null) | .userUid,.timestamp,.type,.url' \
| java -jar target/drift-loader.jar --keyspace vdna --table events

#stream of pageviews
~/kafka8 --topic pageviews \
| jq -r 'select(.userUid!=null and .type!=null) | .userUid,.timestamp,.type,.url' \
| java -jar target/drift-loader.jar --keyspace vdna --table events



#query transformation of vdna pageviews into the 'a' id-space
use vdna
select partner_user_id,user_uid from syncs where id_space='a' join select user_uid,url,timestamp from events
select partner_user_id,url,timestamp from (select user_uid,partner_user_id from syncs where id_space='a' join select user_uid,url,timestamp from events)